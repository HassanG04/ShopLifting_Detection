<!doctype html>
<html lang="en" data-theme="system">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home • Shoplift.AI</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v={{ style_v }}">
  <script>
    // Theme init
    (function(){
      const saved = localStorage.getItem('theme') || 'system';
      document.documentElement.setAttribute('data-theme', saved);
      function apply(mode){
        let dark = matchMedia('(prefers-color-scheme: dark)').matches;
        if (mode==='light') dark=false; if (mode==='dark') dark=true;
        document.documentElement.classList.toggle('dark', dark);
        document.documentElement.classList.toggle('light', !dark);
      }
      apply(saved);
      window.__setTheme = (m)=>{ localStorage.setItem('theme', m); document.documentElement.setAttribute('data-theme', m); apply(m);
        document.querySelectorAll('[data-theme-btn]').forEach(b=>b.classList.remove('active'));
        const btn=document.querySelector(`[data-theme-btn="${m}"]`); if(btn) btn.classList.add('active');
      };
      addEventListener('DOMContentLoaded', ()=>{
        const curr=document.documentElement.getAttribute('data-theme')||'system';
        const btn=document.querySelector(`[data-theme-btn="${curr}"]`); if(btn) btn.classList.add('active');
      });
    })();
  </script>
</head>
<body data-page="home">
  <nav class="navbar">
    <div class="nav-left">
      <a class="brand" href="{{ url_for('index') }}">Shoplift.AI</a>
      <a class="nav-link active" href="{{ url_for('index') }}">Home</a>
      <a class="nav-link" href="{{ url_for('about') }}">About</a>
    </div>
    <div class="nav-right theme-toggle">
      <button class="theme-btn" data-theme-btn="light"  onclick="__setTheme('light')">Light</button>
      <button class="theme-btn" data-theme-btn="system" onclick="__setTheme('system')">System</button>
      <button class="theme-btn" data-theme-btn="dark"   onclick="__setTheme('dark')">Dark</button>
    </div>
  </nav>

  <div class="wrap">
    <header class="card">
      <h1>Upload & Analyze</h1>
      <p>Pick a video and press <strong>Analyze</strong>. That’s it.</p>
    </header>

    <div class="content card">
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="flashes">
            {% for m in messages %}<div class="flash">{{ m }}</div>{% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <section class="panel">
        <h2>Analyze a video</h2>
        <form method="post" enctype="multipart/form-data" id="uploadForm">
          <div class="row">
            <input id="fileInput" type="file" name="video" accept=".mp4,.avi,.mov,.mkv" required class="hidden-file">
            <button class="btn outline" type="button" id="chooseBtn">Choose File</button>
            <div id="fileName" class="muted">No file chosen</div>
            <button class="btn" type="submit">Analyze</button>
          </div>
          <div class="muted">Allowed: mp4, avi, mov, mkv • T=8 frames uniformly sampled.</div>
        </form>
      </section>

      <section class="panel">
        <h2>Result</h2>
        {% if prediction %}
          <div class="kpi">
            <div class="badge {{ prediction_class }}"><strong class="pred">{{ prediction }}</strong></div>
            <div class="badge success"><strong>Confidence:</strong> {{ '%.3f'|format(confidence) }}</div>
            {% if filename %}<div class="badge"><strong>File:</strong> {{ filename }}</div>{% endif %}
          </div>
          {% if pairs %}
          <div class="probs">
            {% for p, c in pairs %}
              <div class="prob-row">
                <div class="label">{{ c }}</div>
                <div class="bar">
                  <div class="fill" style="--pct: {{ (p * 100) | round(1) }};"></div>
                <div class="pct">{{ (p * 100) | round(1) }}%</div>
              </div>
            {% endfor %}
          </div>
          {% endif %}
        {% else %}
          <p class="muted">No prediction yet.</p>
        {% endif %}
      </section>
    </div>
  </div>

  <script>
    const chooseBtn = document.getElementById('chooseBtn');
    const fileInput = document.getElementById('fileInput');
    const fileName  = document.getElementById('fileName');
    if (chooseBtn && fileInput && fileName) {
      chooseBtn.addEventListener('click', ()=> fileInput.click());
      fileInput.addEventListener('change', ()=>{
        fileName.textContent = fileInput.files.length ? fileInput.files[0].name : 'No file chosen';
      });
    }
  </script>
</body>
</html>
          